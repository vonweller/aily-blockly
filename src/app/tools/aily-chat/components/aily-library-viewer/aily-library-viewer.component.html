<div class="aily-library-viewer">
  <div class="viewer-header">
    <div class="header-left">
      <span class="type-badge">扩展库</span>
      <span class="title" *ngIf="libraryInfo?.name">{{ libraryInfo.name }}</span>
    </div>
    <div class="header-actions">
      <button 
        nz-button 
        nzType="text" 
        nzSize="small"
        nz-tooltip="复制配置"
        (click)="copyToClipboard()">
        <span nz-icon nzType="copy"></span>
      </button>
      <button 
        nz-button 
        nzType="text" 
        nzSize="small"
        nz-tooltip="安装库"
        (click)="installLibrary()"
        *ngIf="canInstall">
        <span nz-icon nzType="download"></span>
      </button>
      <button 
        nz-button 
        nzType="text" 
        nzSize="small"
        nz-tooltip="查看文档"
        (click)="viewDocumentation()"
        *ngIf="libraryInfo?.documentation">
        <span nz-icon nzType="file-text"></span>
      </button>
      <button 
        nz-button 
        nzType="text" 
        nzSize="small"
        nz-tooltip="切换视图"
        (click)="toggleView()">
        <span nz-icon [nzType]="showRaw ? 'eye' : 'code'"></span>
      </button>
    </div>
  </div>
  
  <div class="viewer-content">
    <div *ngIf="!showRaw && libraryInfo" class="library-view">
      <nz-card [nzBordered]="false" class="library-card">
        <div class="library-summary">
          <div class="library-icon" *ngIf="libraryInfo.icon">
            <img [src]="libraryInfo.icon" [alt]="libraryInfo.name" />
          </div>
          <div class="library-info">
            <h4>{{ libraryInfo.name || '未知库' }}</h4>
            <p *ngIf="libraryInfo.description" class="description">
              {{ libraryInfo.description }}
            </p>
            <div class="library-tags" *ngIf="libraryInfo.tags?.length">
              <nz-tag *ngFor="let tag of libraryInfo.tags" nzColor="blue">
                {{ tag }}
              </nz-tag>
            </div>
            <div class="library-version" *ngIf="libraryInfo.version">
              <span class="version-label">版本:</span>
              <code class="version-value">{{ libraryInfo.version }}</code>
            </div>
          </div>
        </div>
        
        <div class="library-details" *ngIf="libraryInfo.blocks?.length">
          <h5>提供的积木块</h5>
          <div class="blocks-grid">
            <div class="block-item" *ngFor="let block of libraryInfo.blocks">
              <div class="block-name">{{ block.name || block.type }}</div>
              <div class="block-category" *ngIf="block.category">
                <nz-tag nzSize="small">{{ block.category }}</nz-tag>
              </div>
            </div>
          </div>
        </div>
        
        <div class="library-functions" *ngIf="libraryInfo.functions?.length">
          <h5>提供的函数</h5>
          <nz-list nzSize="small" [nzDataSource]="libraryInfo.functions" nzBordered>
            <ng-template #renderItem let-func>
              <nz-list-item>
                <div class="function-item">
                  <code class="function-name">{{ func.name }}</code>
                  <span class="function-desc" *ngIf="func.description">
                    {{ func.description }}
                  </span>
                </div>
              </nz-list-item>
            </ng-template>
          </nz-list>
        </div>
        
        <div class="library-dependencies" *ngIf="dependencies?.length">
          <h5>依赖项</h5>
          <div class="dependencies-list">
            <nz-tag *ngFor="let dep of dependencies" nzColor="orange">
              {{ dep }}
            </nz-tag>
          </div>
        </div>
        
        <div class="library-package" *ngIf="libraryInfo.package">
          <div class="package-info">
            <span class="package-label">包名:</span>
            <code class="package-name">{{ libraryInfo.package }}</code>
          </div>
        </div>
      </nz-card>
    </div>
    
    <div *ngIf="showRaw" class="raw-view">
      <pre><code>{{ formatData() }}</code></pre>
    </div>
    
    <div *ngIf="errorMessage" class="error-view">
      <div class="error-content">
        <span nz-icon nzType="exclamation-circle" class="error-icon"></span>
        <span>{{ errorMessage }}</span>
      </div>
    </div>
  </div>
  
  <div class="viewer-footer" *ngIf="data?.metadata">
    <small class="metadata-info">
      <span *ngIf="data.metadata.author" class="author">by {{ data.metadata.author }}</span>
      <span *ngIf="data.metadata.license" class="license">{{ data.metadata.license }}</span>
    </small>
  </div>
</div>
