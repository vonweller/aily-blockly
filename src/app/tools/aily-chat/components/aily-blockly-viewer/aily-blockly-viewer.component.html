<div class="aily-blockly-viewer">
  @if (errorMessage) {
    <div class="error-card">
      <div class="error-content">
        <i class="error-icon">âš ï¸</i>
        <span class="error-text">{{ errorMessage }}</span>
      </div>
      
      @if (rawDataString) {
        <div class="raw-data-section">
          <h4>åŸå§‹æ•°æ®:</h4>
          <pre class="raw-data">{{ rawDataString }}</pre>
        </div>
      }
    </div>
  } @else if (blocklyData) {
    <div class="blockly-card">
      <!-- æ ‡é¢˜å’ŒåŸºæœ¬ä¿¡æ¯ -->
      <div class="card-header">
        <div class="title-section">
          <i class="blockly-icon">ğŸ§©</i>
          <h3>{{ getBlocklyTitle() }}</h3>
        </div>
        <div class="actions">
          <button class="action-btn primary" 
                  [disabled]="getBlockCount() === 0"
                  (click)="importBlockly()"
                  title="å¯¼å…¥åˆ°å½“å‰å·¥ä½œåŒº">
            ğŸ“¥ å¯¼å…¥
          </button>
          <button class="action-btn" 
                  (click)="copyToClipboard()"
                  title="å¤åˆ¶åˆ°å‰ªè´´æ¿">
            ğŸ“‹ å¤åˆ¶
          </button>
          <button class="action-btn" 
                  (click)="toggleRawData()"
                  title="åˆ‡æ¢åŸå§‹æ•°æ®æ˜¾ç¤º">
            {{ showRawData ? 'ğŸ‘ï¸' : 'ğŸ”' }} {{ showRawData ? 'éšè—æºç ' : 'æŸ¥çœ‹æºç ' }}
          </button>
        </div>
      </div>
      
      <!-- æè¿° -->
      <div class="description">
        {{ getBlocklyDescription() }}
      </div>
      
      <!-- è¯¦ç»†ä¿¡æ¯ -->
      <div class="blockly-details">
        <div class="detail-row">
          <span class="detail-label">ç§¯æœ¨å—æ•°é‡:</span>
          <span class="detail-tag blue">{{ getBlockCount() }}</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">å·¥ä½œåŒºä¿¡æ¯:</span>
          <span class="detail-value">{{ getWorkspaceSummary() }}</span>
        </div>
        
        @if (getProjectType() !== 'æœªçŸ¥') {
          <div class="detail-row">
            <span class="detail-label">é¡¹ç›®ç±»å‹:</span>
            <span class="detail-tag green">{{ getProjectType() }}</span>
          </div>
        }
        
        @if (getDifficulty()) {
          <div class="detail-row">
            <span class="detail-label">éš¾åº¦:</span>
            <span class="detail-tag" [style.backgroundColor]="getDifficultyColor(getDifficulty())">
              {{ getDifficulty() }}
            </span>
          </div>
        }
        
        @if (getAuthor()) {
          <div class="detail-row">
            <span class="detail-label">ä½œè€…:</span>
            <span class="detail-value">{{ getAuthor() }}</span>
          </div>
        }
        
        @if (getCreatedTime()) {
          <div class="detail-row">
            <span class="detail-label">åˆ›å»ºæ—¶é—´:</span>
            <span class="detail-value">{{ getCreatedTime() }}</span>
          </div>
        }
        
        @if (getTags().length > 0) {
          <div class="detail-row">
            <span class="detail-label">æ ‡ç­¾:</span>
            <div class="tags">
              @for (tag of getTags(); track tag) {
                <span class="tag">{{ tag }}</span>
              }
            </div>
          </div>
        }
      </div>
      
      <!-- é¢„è§ˆå›¾ -->
      @if (hasPreview()) {
        <div class="preview-section">
          <h4>é¢„è§ˆå›¾:</h4>
          <img [src]="getPreviewUrl()" alt="Blocklyé¢„è§ˆ" class="preview-image" />
        </div>
      }
      
      <!-- ä»£ç å±•ç¤º -->
      @if (hasCode() && !showRawData) {
        <div class="code-section">
          <h4>ç”Ÿæˆçš„ä»£ç :</h4>
          <pre class="code-content">{{ getGeneratedCode() }}</pre>
        </div>
      }
      
      <!-- XMLä»£ç å±•ç¤º -->
      @if (getXmlCode() && !showRawData) {
        <div class="xml-section">
          <h4>Blockly XML:</h4>
          <pre class="xml-content">{{ getXmlCode() }}</pre>
        </div>
      }
      
      <!-- åŸå§‹æ•°æ®å±•ç¤º -->
      @if (showRawData) {
        <div class="raw-data-section">
          <h4>åŸå§‹æ•°æ®:</h4>
          <pre class="raw-data">{{ rawDataString }}</pre>
        </div>
      }
      
      <!-- å¦‚æœæ²¡æœ‰ä»£ç å’Œé¢„è§ˆï¼Œæ˜¾ç¤ºå ä½ç¬¦ -->
      @if (!hasCode() && !hasPreview() && !showRawData) {
        <div class="blockly-preview">
          <div class="preview-placeholder">
            <i class="placeholder-icon">ğŸ§©</i>
            <span>Blockly ç§¯æœ¨å—é¡¹ç›®</span>
            <small>ç‚¹å‡»å¯¼å…¥æŒ‰é’®å°†ç§¯æœ¨å—æ·»åŠ åˆ°å·¥ä½œåŒº</small>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="loading-card">
      <div class="loading-content">
        <i class="loading-icon">â³</i>
        <span>åŠ è½½ Blockly æ•°æ®ä¸­...</span>
      </div>
    </div>
  }
</div>
