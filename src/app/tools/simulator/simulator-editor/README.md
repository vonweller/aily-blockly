# Arduino 电路仿真器使用说明

## 功能特性

### 🔧 组件管理
- **Arduino UNO**: 带有数字引脚(D2-D5)、模拟引脚(A0-A1)、电源(5V)和地线(GND)
- **温度传感器**: TMP36温度传感器，包含VCC、OUT、GND引脚
- **LED**: 发光二极管，包含阳极(A)和阴极(K)引脚

### 🎮 交互操作
- **拖拽组件**: 点击并拖拽组件可改变位置，连接线会自动更新
- **引脚连接**: 点击源引脚开始连接，再点击目标引脚完成连接
- **删除连接**: 点击连接线可删除该连接
- **取消连接**: 在连接模式下点击空白区域取消当前连接

### 🎨 视觉效果
- **智能避障**: 连接线会自动避开其他组件
- **平滑路径**: 使用贝塞尔曲线优化连接线显示
- **引脚状态**: 不同类型引脚使用不同颜色标识
- **悬停效果**: 鼠标悬停时的视觉反馈

### 🔌 引脚类型
- **数字引脚** (蓝色): 数字输入/输出
- **模拟引脚** (橙色): 模拟输入/输出  
- **电源引脚** (红色): 5V电源供应
- **地线引脚** (灰色): 接地连接

### 📊 连接颜色编码
- **电源连接** (红色): 涉及电源引脚的连接
- **地线连接** (灰色): 涉及地线引脚的连接
- **模拟连接** (橙色): 涉及模拟引脚的连接
- **数字连接** (绿色): 数字引脚之间的连接

## 使用步骤

1. **添加组件**: 点击工具栏中的组件按钮添加到画布
2. **移动组件**: 拖拽组件到合适位置
3. **创建连接**: 
   - 点击源引脚开始连接
   - 点击目标引脚完成连接
   - 系统会自动验证连接的有效性
4. **管理连接**: 点击连接线可删除不需要的连接
5. **导出电路**: 点击"导出连接"按钮获取电路配置

## 技术实现

### 核心技术栈
- **Angular 19**: 前端框架
- **Konva.js**: 2D画布渲染引擎
- **@wokwi/elements**: 电子组件Web Components
- **TypeScript**: 类型安全的开发体验

### 核心算法
- **A*路径查找**: 智能避障连接线生成
- **贝塞尔曲线**: 平滑的连接线渲染
- **碰撞检测**: 组件重叠检测
- **动态更新**: 实时连接线重绘

### 架构设计
- **组件化架构**: 可扩展的组件系统
- **事件驱动**: 响应式用户交互
- **内存管理**: 自动清理DOM和Canvas元素
- **性能优化**: 批量渲染和事件节流

## 扩展开发

### 添加新组件类型
```typescript
// 在createXXXComponent方法中定义新组件
private createNewComponent(id: string, x: number, y: number): CircuitComponent {
  return {
    id,
    type: 'newType',
    x, y,
    width: 100,
    height: 80,
    pins: [
      { id: 'PIN1', x: 10, y: 20, type: 'digital', label: 'PIN1', connected: false }
    ]
  };
}
```

### 自定义连接规则
```typescript
// 在completeConnection方法中添加验证逻辑
private validateConnection(fromPin: Pin, toPin: Pin): boolean {
  // 添加自定义连接规则
  if (fromPin.type === 'power' && toPin.type === 'ground') {
    return false; // 禁止电源直接连接地线
  }
  return true;
}
```

### 添加仿真功能
```typescript
// 集成AVR8js或其他仿真引擎
private runSimulation() {
  // 根据连接配置运行仿真
  const circuit = this.exportConnections();
  // 发送到仿真引擎...
}
```

## 故障排除

### 常见问题
1. **组件无法拖拽**: 检查Konva舞台是否正确初始化
2. **连接线不显示**: 验证引脚坐标计算是否正确
3. **性能问题**: 减少同时显示的组件数量，启用批量渲染

### 调试技巧
- 使用浏览器开发者工具检查Canvas元素
- 在控制台查看导出的连接数据
- 监控内存使用情况，确保正确清理资源

## 版本信息
- 当前版本: 1.0.0
- 兼容性: 现代浏览器 (Chrome 80+, Firefox 75+, Safari 13+)
- 依赖版本: Angular 19, Konva 9.3+, @wokwi/elements 1.7+
