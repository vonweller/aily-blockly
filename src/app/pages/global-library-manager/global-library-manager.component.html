<div class="global-library-manager-box">
  <div class="header">
    <div class="btn ccenter" (click)="back()" nz-tooltip nzTooltipTitle="返回">
      <i class="fa-regular fa-chevron-left"></i>
    </div>
    <div class="title">
      <h3>全局库管理</h3>
      <span class="count">共 {{ getLibraryCount() }} 个全局库</span>
    </div>
    <div class="actions">
      <button nz-button nzType="default" nzSize="small" (click)="openConfigLocation()" 
              nz-tooltip nzTooltipTitle="打开配置文件位置">
        <i class="fa-light fa-folder-open"></i>
      </button>
      <button nz-button nzType="default" nzSize="small" (click)="importGlobalLibraries()" 
              nz-tooltip nzTooltipTitle="导入全局库配置">
        <i class="fa-light fa-upload"></i>
      </button>
      <button nz-button nzType="default" nzSize="small" (click)="exportGlobalLibraries()" 
              nz-tooltip nzTooltipTitle="导出全局库配置">
        <i class="fa-light fa-download"></i>
      </button>
      <button nz-button nzType="primary" nzDanger nzSize="small" (click)="clearAllGlobalLibraries()" 
              nz-tooltip nzTooltipTitle="清空所有全局库">
        <i class="fa-light fa-trash"></i>
      </button>
    </div>
  </div>

  <div class="content">
    @if (loading) {
    <div class="loading-container">
      <i class="fa-duotone fa-solid fa-spinner-third fa-spin"></i>
      <span>加载中...</span>
    </div>
    } @else if (globalLibraries.length === 0) {
    <div class="empty-container">
      <div class="empty-icon">
        <i class="fa-light fa-box-open"></i>
      </div>
      <div class="empty-text">
        <h4>暂无全局库</h4>
        <p>在库管理器中将库设置为全局模式，新建项目时会自动安装这些库</p>
      </div>
    </div>
    } @else {
    <nz-table #basicTable [nzData]="globalLibraries" [nzShowPagination]="false" [nzSize]="'small'">
      <thead>
        <tr>
          <th>库名称</th>
          <th>版本</th>
          <th>描述</th>
          <th>添加时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        @for (library of basicTable.data; track library.name) {
        <tr>
          <td>
            <div class="library-name">
              <strong>{{ library.nickname }}</strong>
              <small>{{ library.name }}</small>
            </div>
          </td>
          <td>
            <nz-tag nzColor="blue">{{ library.version }}</nz-tag>
          </td>
          <td>
            <span class="description" [title]="library.description">
              {{ library.description || '无描述' }}
            </span>
          </td>
          <td>
            <span class="add-time">{{ formatDate(library.addedAt) }}</span>
          </td>
          <td>
            <button nz-button nzType="text" nzDanger nzSize="small" 
                    (click)="removeGlobalLibrary(library)"
                    nz-tooltip nzTooltipTitle="从全局库中移除">
              <i class="fa-light fa-trash"></i>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </nz-table>
    }
  </div>

  @if (globalLibraries.length > 0) {
  <div class="footer">
    <div class="info">
      <i class="fa-light fa-info-circle"></i>
      <span>全局库会在创建新项目时自动安装，不会影响现有项目</span>
    </div>
  </div>
  }
</div>
