<!-- 关键记忆管理板块 -->
<div class="section-card key-memory-section">
  <div class="section-header">
    <div class="section-icon">
      <i class="icon-key"></i>
    </div>
    <h2>关键记忆系统</h2>
    <div class="section-actions">
      <button class="btn-primary" (click)="onAddKeyMemory()">新增记忆</button>
      <button class="btn-secondary" (click)="onImportKeyMemory()">导入</button>
      <button class="btn-secondary" (click)="onExportKeyMemory()">导出</button>
    </div>
  </div>
  
  <div class="section-content">
    <!-- 统计信息 -->
    <div class="stats-row">
      <div class="stat-item">
        <span class="stat-number">{{keyMemoryStats.total}}</span>
        <span class="stat-label">总记忆</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{keyMemoryStats.categories}}</span>
        <span class="stat-label">分类</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{keyMemoryStats.recentlyUsed}}</span>
        <span class="stat-label">最近使用</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{keyMemoryStats.secrets}}</span>
        <span class="stat-label">机密项</span>
      </div>
    </div>

    <!-- 搜索和筛选 -->
    <div class="search-controls">
      <div class="search-bar">
        <i class="icon-search"></i>
        <input type="text" 
               placeholder="搜索关键记忆..." 
               [(ngModel)]="searchQuery"
               class="search-input">
      </div>
      
      <div class="filter-controls">
        <select [(ngModel)]="selectedType" class="type-filter">
          <option value="all">所有类型</option>
          <option value="string">文本</option>
          <option value="number">数字</option>
          <option value="boolean">布尔值</option>
          <option value="json">JSON</option>
          <option value="url">链接</option>
          <option value="file">文件</option>
        </select>
        
        <label class="secret-toggle">
          <input type="checkbox" [(ngModel)]="showSecrets">
          <span class="checkmark"></span>
          显示机密
        </label>
      </div>
    </div>

    <!-- 快速访问 -->
    <div class="quick-access" *ngIf="quickAccessItems.length > 0">
      <h3>快速访问</h3>
      <div class="quick-items">
        <div class="quick-item" *ngFor="let item of quickAccessItems">
          <div class="item-key">{{item.key}}</div>
          <div class="item-value" [style.color]="getTypeColor(item.type)">
            {{truncateValue(formatValue(item))}}
          </div>
          <button class="btn-copy" (click)="onCopyKeyMemory(item)" title="复制">
            <i class="icon-copy"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 分类列表 -->
    <div class="categories-list">
      <div class="category-section" *ngFor="let category of keyMemoryCategories">
        <div class="category-header" (click)="toggleCategory(category)">
          <i [class]="category.icon" [style.color]="category.color"></i>
          <span class="category-name">{{category.name}}</span>
          <span class="item-count">({{category.items.length}})</span>
          <i class="icon-chevron" [class.expanded]="category.expanded"></i>
        </div>
        
        <div class="category-items" *ngIf="category.expanded">
          <div class="memory-item" *ngFor="let item of category.items">
            <div class="item-header">
              <div class="item-info">
                <div class="item-key">
                  <i [class]="getTypeIcon(item.type)" [style.color]="getTypeColor(item.type)"></i>
                  <span class="key-text">{{item.key}}</span>
                  <span class="secret-badge" *ngIf="item.isSecret">
                    <i class="icon-lock"></i>
                  </span>
                </div>
                <div class="item-description" *ngIf="item.description">
                  {{item.description}}
                </div>
              </div>
              
              <div class="item-actions">
                <button class="btn-icon" (click)="onCopyKeyMemory(item)" title="复制值">
                  <i class="icon-copy"></i>
                </button>
                <button class="btn-icon" (click)="onToggleSecret(item)" *ngIf="item.isSecret" title="切换显示">
                  <i class="icon-eye"></i>
                </button>
                <button class="btn-icon" (click)="onEditKeyMemory(item)" title="编辑">
                  <i class="icon-edit"></i>
                </button>
                <button class="btn-icon" (click)="onDeleteKeyMemory(item)" title="删除">
                  <i class="icon-delete"></i>
                </button>
              </div>
            </div>
            
            <div class="item-content">
              <div class="value-container">
                <div class="value-text" [class.truncated]="isValueTruncated(item.value)">
                  <pre *ngIf="item.type === 'json'">{{formatValue(item)}}</pre>
                  <span *ngIf="item.type !== 'json'">{{formatValue(item)}}</span>
                </div>
                <button class="btn-expand" *ngIf="isValueTruncated(item.value)" title="展开">
                  <i class="icon-expand"></i>
                </button>
              </div>
              
              <div class="item-meta">
                <div class="tags" *ngIf="item.tags.length > 0">
                  <span class="tag" *ngFor="let tag of item.tags">{{tag}}</span>
                </div>
                <div class="meta-info">
                  <span class="access-count">访问 {{item.accessCount}} 次</span>
                  <span class="last-modified">{{item.lastModified | date:'short'}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 最近使用 -->
    <div class="recent-items" *ngIf="recentItems.length > 0">
      <h3>最近使用</h3>
      <div class="recent-list">
        <div class="recent-item" *ngFor="let item of recentItems">
          <i [class]="getTypeIcon(item.type)" [style.color]="getTypeColor(item.type)"></i>
          <div class="recent-info">
            <span class="recent-key">{{item.key}}</span>
            <span class="recent-value">{{truncateValue(formatValue(item))}}</span>
          </div>
          <button class="btn-copy" (click)="onCopyKeyMemory(item)">
            <i class="icon-copy"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
